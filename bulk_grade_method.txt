    private void showBulkGradeDialog() {
        Dialog<Boolean> dialog = new Dialog<>();
        dialog.setTitle("Bulk Grade Entry");
        dialog.setHeaderText("Enter Grades for Entire Class");
        ButtonType saveBtn = new ButtonType("Save All", ButtonData.OK_DONE);
        dialog.getDialogPane().getButtonTypes().addAll(saveBtn, ButtonType.CANCEL);

        VBox content = new VBox(15);
        content.setPadding(new Insets(20));
        content.setPrefWidth(700);

        // Course and Exam Type selection
        GridPane selectionGrid = new GridPane();
        selectionGrid.setHgap(10);
        selectionGrid.setVgap(10);

        ComboBox<Course> courseCombo = new ComboBox<>();
        try {
            CourseDAO courseDAO = new CourseDAO();
            courseCombo.getItems().addAll(courseDAO.getAllCourses());
        } catch (Exception e) { /* Ignore */ }
        courseCombo.setPromptText("Select Course");

        ComboBox<String> examTypeCombo = new ComboBox<>();
        examTypeCombo.getItems().addAll("Midterm", "Final", "Quiz", "Assignment", "Project");
        examTypeCombo.setPromptText("Select Exam Type");

        TextField maxMarksField = new TextField("100");
        maxMarksField.setPromptText("Max Marks");

        selectionGrid.add(new Label("Course:"), 0, 0);
        selectionGrid.add(courseCombo, 1, 0);
        selectionGrid.add(new Label("Exam Type:"), 0, 1);
        selectionGrid.add(examTypeCombo, 1, 1);
        selectionGrid.add(new Label("Max Marks:"), 0, 2);
        selectionGrid.add(maxMarksField, 1, 2);

        Button loadStudentsBtn = createButton("Load Students", "#3b82f6");
        
        // Student table for bulk grading
        TableView<BulkGradeRecord> gradeTable = new TableView<>();
        gradeTable.setPrefHeight(300);
        ObservableList<BulkGradeRecord> records = FXCollections.observableArrayList();
        gradeTable.setItems(records);

        TableColumn<BulkGradeRecord, String> nameCol = new TableColumn<>("Student Name");
        nameCol.setCellValueFactory(data -> new SimpleStringProperty(data.getValue().studentName));
        nameCol.setPrefWidth(200);

        TableColumn<BulkGradeRecord, String> enrollCol = new TableColumn<>("Enrollment");
        enrollCol.setCellValueFactory(data -> new SimpleStringProperty(data.getValue().enrollment));
        enrollCol.setPrefWidth(120);

        TableColumn<BulkGradeRecord, String> marksCol = new TableColumn<>("Marks Obtained");
        marksCol.setCellValueFactory(data -> new SimpleStringProperty(
            data.getValue().marks != null ? String.valueOf(data.getValue().marks) : ""));
        marksCol.setCellFactory(col -> new TableCell<BulkGradeRecord, String>() {
            private TextField textField;

            @Override
            protected void updateItem(String item, boolean empty) {
                super.updateItem(item, empty);
                if (empty) {
                    setGraphic(null);
                } else {
                    if (textField == null) {
                        textField = new TextField();
                        textField.setPrefWidth(80);
                        textField.textProperty().addListener((obs, old, newVal) -> {
                            BulkGradeRecord record = getTableView().getItems().get(getIndex());
                            try {
                                record.marks = newVal.isEmpty() ? null : Double.parseDouble(newVal);
                            } catch (NumberFormatException e) {
                                record.marks = null;
                            }
                        });
                    }
                    textField.setText(item);
                    setGraphic(textField);
                }
            }
        });
        marksCol.setPrefWidth(120);

        gradeTable.getColumns().addAll(nameCol, enrollCol, marksCol);

        loadStudentsBtn.setOnAction(e -> {
            if (courseCombo.getValue() == null) {
                showAlert("Error", "Please select a course");
                return;
            }
            records.clear();
            List<Student> students = studentDAO.getAllStudents();
            for (Student s : students) {
                records.add(new BulkGradeRecord(s));
            }
        });

        content.getChildren().addAll(selectionGrid, loadStudentsBtn, gradeTable);
        dialog.getDialogPane().setContent(content);

        dialog.setResultConverter(btn -> {
            if (btn == saveBtn && courseCombo.getValue() != null && examTypeCombo.getValue() != null) {
                int saved = 0;
                double maxMarks = Double.parseDouble(maxMarksField.getText());
                for (BulkGradeRecord record : records) {
                    if (record.marks != null) {
                        Grade g = new Grade();
                        g.setStudentId(record.studentId);
                        g.setCourseId(courseCombo.getValue().getId());
                        g.setExamType(examTypeCombo.getValue());
                        g.setMarksObtained(record.marks);
                        g.setMaxMarks(maxMarks);
                        
                        if (gradeDAO.addOrUpdateGrade(g)) {
                            saved++;
                        }
                    }
                }
                showAlert("Success", saved + " grades saved successfully!");
                loadGrades();
                return true;
            }
            return false;
        });

        dialog.showAndWait();
    }

    // Helper class for bulk grading
    private static class BulkGradeRecord {
        int studentId;
        String studentName;
        String enrollment;
        Double marks;

        BulkGradeRecord(Student s) {
            this.studentId = s.getId();
            this.studentName = s.getName();
            this.enrollment = s.getUsername();
            this.marks = null;
        }
    }
